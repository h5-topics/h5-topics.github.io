{"version":3,"file":"static/webpack/static\\development\\pages\\topic.js.cbbdceb3a9860bfa1cf7.hot-update.js","sources":["webpack:///./components/topic/message-list-item.jsx"],"sourcesContent":["import { useCallback, useState, useContext, useRef, useEffect } from 'react'\r\nimport share from '../common/share'\r\nimport { Context } from '.'\r\n\r\nconsole.log(share)\r\n\r\nconst useMessgaeStateHook = (message) => {\r\n  const [ up_count, setUpCount ] = useState(message.up_count)\r\n  const [ down_count, setDownCount ] = useState(message.down_count)\r\n\r\n  const getLocalState = useCallback(() => {\r\n    return localStorage.getItem('message_' + message.ID) || 'noset'\r\n  }, [])\r\n  const setLocalState = useCallback(state => {\r\n    localStorage.setItem('message_' + message.ID, state)\r\n  }, [])\r\n  const { setToast, setOpenedMessage } = useContext(Context)\r\n\r\n  const up = useCallback(() => {\r\n    const state = getLocalState()\r\n    switch(state) {\r\n      case 'noset':\r\n        setUpCount(up_count + 1)\r\n        setLocalState('up')\r\n      break\r\n      case 'up':\r\n        setUpCount(up_count - 1)\r\n        setLocalState('noset')\r\n      break\r\n      default:\r\n        setToast('already ' + state)\r\n    }\r\n  }, [ up_count ])\r\n  const down = useCallback(() => {\r\n    // fetch(`http://127.0.0.1:7001/api/messages/up?message=${ ID }`)\r\n    const state = getLocalState()\r\n    switch(state) {\r\n      case 'noset':\r\n        setDownCount(down_count + 1)\r\n        setLocalState('down')\r\n      break\r\n      case 'down':\r\n        setDownCount(down_count - 1)\r\n        setLocalState('noset')\r\n      break\r\n      default:\r\n        setToast('already ' + state)\r\n    }\r\n  }, [ down_count ])\r\n\r\n  const selectMessage = useCallback(() => {\r\n    setOpenedMessage(message)\r\n  }, [ message ])\r\n\r\n  return [\r\n    { ...message, up_count, down_count },\r\n    up, down, selectMessage\r\n]\r\n}\r\n\r\nconst stopPropagation = e => e.stopPropagation()\r\n\r\n\r\nconst MessageItem = ({ message }) => {\r\n  const [\r\n    { message_content, comment_count, up_count, down_count, whatsapp_share_count = 0 },\r\n    onUpClick, onDownClick, onCommentClick\r\n  ] = useMessgaeStateHook(message)\r\n\r\n  const extendMenu = useRef()\r\n  const openExtendMenu = useCallback(e => {\r\n    extendMenu.current.classList.toggle('show')\r\n    e.stopPropagation()\r\n  }, [])\r\n  const closeExtendMenu = useCallback(() => {\r\n    extendMenu.current.classList.remove('show')\r\n  }, [])\r\n  useEffect(() => {\r\n    document.body.addEventListener('click', closeExtendMenu)\r\n    share.init()\r\n    return () => {\r\n      document.body.removeEventListener('click', closeExtendMenu)\r\n    }\r\n  }, [])\r\n\r\n  return <div className=\"message-item-wrapper\">\r\n    <div className=\"message-item-content\">{ message_content }</div>\r\n    <div className=\"message-item-extend\">\r\n      <div className=\"message-item-extend-piece\" style={ { textAlign: 'left' } }>\r\n        <a className=\"link with-whatsapp\" data-share=\"whatsapp\">{ whatsapp_share_count }</a>\r\n      </div>\r\n      <div className=\"message-item-extend-piece\"><a className=\"link with-comment\" onClick={ onCommentClick }>{ comment_count }</a></div>\r\n      <div className=\"message-item-extend-piece\"><a className=\"link with-like\" onClick={ onUpClick }>{ up_count }</a></div>\r\n      <div className=\"message-item-extend-piece\"><a className=\"link with-dislike\" onClick={ onDownClick }>{ down_count }</a></div>\r\n      <div className=\"message-item-extend-piece\" style={ { textAlign: 'right' } }>\r\n        <a className=\"link with-extend\" onClick={ openExtendMenu }/>\r\n        <div className=\"extend-menu\" ref={ extendMenu } onClickCapture={ stopPropagation }>\r\n          <a className=\"link with-facebook\" onClick={ closeExtendMenu }/>\r\n          <a className=\"link with-whatsapp\" onClick={ closeExtendMenu }/>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n}\r\n\r\nexport default MessageItem"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAAA;AAAA;AACA;AAWA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAVA;AAYA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAVA;AAYA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AADA;AAIA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;;;;A","sourceRoot":""}